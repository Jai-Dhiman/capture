name = "capture-api"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Non-sensitive environment variables
[vars]
ENV = "production"
CDN_DOMAIN = "cdn.capture-app.com"
CDN_ZONE_ID = ""
SSL_MODE = "flexible"
TLS_VERSION = "1.3"
HSTS_ENABLED = "true"
HSTS_MAX_AGE = "31536000"

# Development environment
[env.development]
name = "capture-api-dev"
vars = { ENV = "development" }

# Staging environment
[env.staging]
name = "capture-api-staging"
vars = { ENV = "staging" }

[[d1_databases]]
binding = "DB"
database_name = "capture-db"
database_id = "adb1ae42-b82f-44d2-968c-0e7ac0d92200"
migrations_dir = "drizzle"

[[r2_buckets]]
binding = "IMAGE_STORAGE"
bucket_name = "capture-images"

[[kv_namespaces]]
binding = "CAPTURE_KV"
id = "33f2f79c71fc4bdcbc2b81e7913feb65"

[[queues.producers]]
binding = "POST_QUEUE"
queue = "post-queue"

[[queues.producers]]
binding = "USER_VECTOR_QUEUE"
queue = "user-vector-queue"

[[queues.consumers]]
queue = "post-queue"

[[queues.consumers]]
queue = "user-vector-queue"

[observability.logs]
enabled = true
